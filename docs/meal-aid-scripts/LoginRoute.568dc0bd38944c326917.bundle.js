"use strict";(self.webpackChunkmealaid=self.webpackChunkmealaid||[]).push([[119],{8910:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var r=n(7294),a=n(7672),o=n(6310),l=n(1876),s=n(9602),i=n(1508),m=n(6914),c=n(9062);function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}function u(e){return r.createElement(i.Z,{position:"relative",display:"inline-block"},e.children||(e.text||e.ButtonProps)&&r.createElement(m.Z,e.ButtonProps||{},e.text)||null,e.loading&&r.createElement(p,d({},e.CircularProgressProps||{},{size:24},e.size&&!isNaN(e.size)?{size:e.size,style:{marginTop:-1*Math.round(e.size/2),marginLeft:-1*Math.round(e.size/2)}}:{})))}const p=(0,s.ZP)(c.Z)({position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"});var g=n(2961),h=n(6867),f=n(270),E=n(148);function w(e){const[t,n]=r.useState(!1),a="register"===e.type,o="login"===e.type,s="reset"===e.type,i=()=>n((e=>!e)),m=e=>{e.preventDefault()},c=(()=>{switch(e.type){case"forgot":return"Send reset link";case"resend":return"Resend confirmation";case"register":return"Register";case"reset":return"Reset & Login";default:return"Login"}})();return r.createElement("div",null,r.createElement(l.J9,{initialValues:{email:"",password:"",name:""},validationSchema:a?y:o||s?v:b,onSubmit:t=>{null==e.onSubmit||e.onSubmit({...t,email:t.email.toLowerCase()})}},(({errors:n,touched:l,handleSubmit:d,values:p,handleChange:w})=>r.createElement("form",{onSubmit:d},a&&r.createElement(E.Z,{value:p.name,onChange:w("name"),variant:"outlined",label:"Name",type:"name",error:Boolean(l.name&&n.name),helperText:l.name&&n.name||void 0,placeholder:"Enter name",fullWidth:!0,sx:{mt:2}}),r.createElement(E.Z,{value:p.email,onChange:w("email"),variant:"outlined",label:"Email",type:"email",error:Boolean(l.email&&n.email),helperText:l.email&&n.email||void 0,placeholder:"Enter email",fullWidth:!0,sx:{mt:2}}),(o||a||s)&&r.createElement(E.Z,{value:p.password,onChange:w("password"),variant:"outlined",label:(s?"New ":"")+"Password",error:Boolean(l.password&&n.password),helperText:l.password&&n.password||(a||s?"At least 8 characters":void 0),placeholder:`Enter${s?" new":""} password`,fullWidth:!0,sx:{mt:2},type:t?"text":"password",InputProps:{endAdornment:r.createElement(f.Z,{position:"end"},r.createElement(h.Z,{"aria-label":"toggle password visibility",onClick:i,onMouseDown:m,edge:"end"},r.createElement(g.Z,null)))}}),r.createElement("div",null,r.createElement(u,{loading:e.loading,text:c,ButtonProps:{variant:"contained",size:"large",sx:{m:2},type:"submit"},CircularProgressProps:{color:"secondary"}}))))))}const v=o.Ry().shape({email:o.Z_().email().required(),password:o.Z_().required().min(8)}),y=o.Ry().shape({name:o.Z_().required(),email:o.Z_().email().required(),password:o.Z_().required().min(8)}),b=o.Ry().shape({email:o.Z_().email().required()});var Z=n(9711),P=n(6974),k=n(3970),x=n(4638),C=n(4438),S=n(6634),U=n(2658);function I(){const e=(0,P.UO)(),[t]=(0,Z.lr)(),n=(0,P.s0)(),{realm:o,user:l,setUser:s}=r.useContext(k._),[i,m]=r.useState(""),[c,d]=r.useState(null),u=(0,a.Z)(null),p=(()=>{switch(e.type){case"forgot":case"resend":case"register":case"reset":return e.type;default:return"login"}})(),g="register"===p,h="confirm"===e.type;r.useEffect((()=>{if(h){const e=t.get("token"),n=t.get("tokenId");e&&n?o.emailPasswordAuth.confirmUser({token:t.get("token"),tokenId:t.get("tokenId")}).then((()=>d(!0))).catch((e=>{d(!1),m((null==e?void 0:e.error)||(null==e?void 0:e.message)||"Unable to confirm email")})):m("Invalid email confirmation")}}),[h]);const f=e=>{m(""),u.setErrorMsg(""),n(e)},E=(()=>{switch(e.type){case"forgot":case"reset":return"Reset Password";case"resend":case"register":return"Register";default:return"Login"}})();return l&&"anon-user"!==l.providerType?r.createElement(R,null,r.createElement(U.Z,null,"Already logged in!")):r.createElement(R,null,r.createElement("div",null,r.createElement("div",null,r.createElement(U.Z,{variant:"h5",sx:{ml:2}},E)),r.createElement(w,{type:p,onSubmit:e=>{if(e.email&&e.password){const t=x.cN.emailPassword(e.email,e.password);"login"===p?u.fetch((()=>o.logIn(t).then((e=>{s(e);const t=o.currentUser;if(t&&!t.customData.name){const e=t&&t.mongoClient("mongodb-atlas");e&&e.db("Users").collection("UserInfoTemp").findOne({_id:t.profile.email}).then((n=>{e.db("Users").collection("UserInfo").updateOne({userId:t.id},{$set:{name:n.name}}).then((e=>{1===e.modifiedCount&&t.refreshCustomData()}))}))}n(`/${C.USER_ROUTE_ID}`)})))):g?u.fetch((()=>o.emailPasswordAuth.registerUser({email:e.email,password:e.password}).then((()=>{const t=o.currentUser;t&&t.mongoClient("mongodb-atlas").db("Users").collection("UserInfoTemp").insertOne({_id:e.email,name:e.name})})).then((()=>{n("login"),m("Success! Please check your email to complete sign up")})))):"reset"===p&&u.fetch((()=>o.emailPasswordAuth.resetPassword({password:e.password,token:"",tokenId:""}).then((()=>o.logIn(t).then((e=>s(e))))).then((()=>n(`/${C.USER_ROUTE_ID}`)))))}else"forgot"===p&&e.email?u.fetch((()=>o.emailPasswordAuth.sendResetPasswordEmail({email:e.email}).then((()=>m("Please check your email and click on the link reset password"))))):"resend"===p&&e.email&&u.fetch((()=>o.emailPasswordAuth.resendConfirmationEmail({email:e.email}).then((()=>m("Please check your email to complete sign up")))))},loading:u.loading}),c&&r.createElement(U.Z,{sx:{m:2},color:"secondary"},"Email confirmed! You may now log in"),i&&r.createElement(U.Z,{sx:{m:2}},i),u.error&&r.createElement(U.Z,{color:"error",sx:{m:2}},"Error: ",u.errorMsg),r.createElement(_,null,r.createElement(U.Z,{variant:"body2"},"login"!==p?"Have an account?":"Don't have an account?"),r.createElement(S.Z,{onClick:()=>f("login"!==p?"":"register"),component:"button",variant:"body2",sx:{ml:1}},"login"!==p?"Log in":"Sign up")),"login"===p&&r.createElement(r.Fragment,null,r.createElement(S.Z,{onClick:()=>f("forgot"),component:"button",variant:"body2",sx:{mt:1,ml:2}},"I forgot my password"),r.createElement(S.Z,{onClick:()=>f("resend"),component:"button",variant:"body2",sx:{mt:1,ml:2}},"Resend confirmation email"))))}const R=(0,s.ZP)("div")((({theme:e})=>({padding:e.spacing(4),display:"flex",justifyContent:"center","& > div:first-child":{width:450}}))),_=(0,s.ZP)("div")((({theme:e})=>({display:"flex",alignItems:"center",marginLeft:e.spacing(2)})))},7672:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(7294);function a(e){const[t,n]=r.useState(e),[a,o]=r.useState(!1),[l,s]=r.useState(""),[i,m]=r.useState(0),[c,d]=r.useState(!1);return{value:t,fetch:e=>Promise.resolve().then((()=>{o(!0),s(""),d(!1)})).then(e).then((e=>(c||(n(e),m((new Date).getTime()),o(!1)),e))).catch((e=>{c||(s(`${e&&(e.error||e.message)||"Unknown error"}`),o(!1))})),setValue:n,loading:a,time:i,errorMsg:l,setErrorMsg:s,error:Boolean(l),cancelled:c,cancel:()=>d(!0)}}}}]);